# Prerequisite

-   A quick look of our API documentation: `https://doc.punchplatform.com/doc/punchplatform-pyspark/html/index.html`
-   Brainstorm your use-case with our existing nodes: `https://doc.punchplatform.com/Reference_Guide/Data_Analytics/Nodes/Elastic_Input.html`
-   A 6.1+ punchplatform release
-   $PUNCHPLATFORM_ANALYTICS_INSTALL_DIR must be defined

# Notes

A `Makefile` is put at your disposal, use it to clean, lint and format your custom node code !

```sh
# check lint and code formatting for module algorithms
# in general; you should launch this command before any commit
make inspect path=nodes/

# clean unwanted .pyc if any or other python related binaries during runtime execution
make clean
```

**Note 1**

If you are using an IDE like Pycharm (or similar); configure your IDE to use the generated `.venv` from this directory.

**Note 2**

- We expect that on your platform python is a symlink to python3.
- We highly advice you to use some python manager like `pyenv` for development phase !

**Note 3**

We provided a template hierarchy for setuptools to work out of the box; you are free to change it as to meet your requirements; just keep in mind that it should follows PEP convention for PEX packaging to work !

# Quick Start

Template hierarchy:

```sh
├── full_job.punchline
├── Makefile
├── nodes
│   ├── __init__.py
│   └── my_use_case
│       ├── __init__.py
│       └── my_node
│           ├── complex_algorithm.py
│           └── __init__.py
├── README.md
└── setup.py
```

## Step one

```sh
# get all available commands
make

# info
punchpkg analytics info

# result
{
    "analytics_install_dir": {
        "dir": "/home/jonathan/Desktop/standalone/punchplatform-standalone-6.1.0-SNAPSHOT-linux/external/punchplatform-binaries-6.1.0-SNAPSHOT/punchplatform-spark-6.1.0-SNAPSHOT",
        "info": "root directory of pexlib, extpex and extlib"
    },
    "pexlib": "internal jars used by our platform",
    "extpex": "your custom pex files (i.e node, udf, udaf or custom dependency)",
    "extlib": "your custom jar that you can include in your analytics classpath"
}
```

## Step two (Packaging)

An example node is given in `nodes` package which contains `my_use_case` module with a sub-module `my_node`

```sh
# IMPORTANT
# Terminal should be at the same location as this README.md
$ROOT=$(realpath README.md)

# after coding your node
make inspect path=nodes/

# build a pex distribution
punchpkg analytics package-pex complex_algorithm_dependencies.pex

# pex archive is generated by default in
$ROOT/dist
```

## Step three (Installation)

```sh
punchpkg analytics install-pex dist/complex_algorithm_dependencies.pex

# check
punchpkg analytics list-dependencies
```

## Step four (Execute to test)

```sh
punchlinectl start -p full_job.punchline -r pyspark
```
